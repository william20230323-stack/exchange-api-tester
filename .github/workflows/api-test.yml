name: API Test
on: push
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-python@v3
        with:
          python-version: '3.9'
      - run: pip install requests
      - run: python -c "
import requests
import sys

exchanges = [
    ('Binance', 'https://api.binance.com/api/v3/ping'),
    ('Coinbase', 'https://api.coinbase.com/v2/time'),
    ('Kraken', 'https://api.kraken.com/0/public/Time')
]

success = 0
total = len(exchanges)

for name, url in exchanges:
    try:
        r = requests.get(url, timeout=5)
        if r.status_code == 200:
            print('OK: ' + name)
            success += 1
        else:
            print('FAIL: ' + name + ' Status: ' + str(r.status_code))
    except Exception as e:
        print('ERROR: ' + name + ' - ' + str(e)[:100])

print('')
print('Total: ' + str(total))
print('Success: ' + str(success))
print('Failed: ' + str(total - success))

if success < total / 2:
    sys.exit(1)
"

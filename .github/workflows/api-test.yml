name: äº¤æ˜“æ‰€APIæ¸¬è©¦

on:
  push:
    branches: [main, master]
  pull_request:
    branches: [main, master]
  schedule:
    - cron: '0 0 * * *'
  workflow_dispatch:

jobs:
  test-exchanges:
    runs-on: ubuntu-latest
    
    steps:
    - name: 1. æª¢å‡ºä»£ç¢¼
      uses: actions/checkout@v4
    
    - name: 2. è¨­ç½®Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    - name: 3. å®‰è£ä¾è³´
      run: |
        pip install aiohttp
    
    - name: 4. å‰µå»ºæ¸¬è©¦è…³æœ¬
      run: |
        mkdir -p scripts
        cat > scripts/quick_test.py << 'EOF'
import asyncio
import aiohttp
import time

async def main():
    print("ðŸ” é–‹å§‹æ¸¬è©¦äº¤æ˜“æ‰€APIé€£é€šæ€§...")
    print("=" * 40)
    
    # æ¸¬è©¦åˆ—è¡¨
    tests = [
        ("Binance", "https://api.binance.com/api/v3/ping"),
        ("KuCoin", "https://api.kucoin.com/api/v1/ping"),
        ("Gate.io", "https://api.gateio.ws/api/v4/spot/tickers?currency_pair=BTC_USDT"),
        ("MEXC", "https://api.mexc.com/api/v3/ping"),
        ("Huobi", "https://api.huobi.pro/market/detail/merged?symbol=btcusdt"),
        ("Bitget", "https://api.bitget.com/api/spot/v1/market/ticker?symbol=BTCUSDT"),
        ("OKX", "https://www.okx.com/api/v5/market/ticker?instId=BTC-USDT"),
        ("Pionex", "https://api.pionex.com/api/v1/market/ticker?symbol=BTC_USDT"),
    ]
    
    results = []
    
    async with aiohttp.ClientSession() as session:
        for name, url in tests:
            start = time.time()
            try:
                async with session.get(url, timeout=10) as response:
                    elapsed = time.time() - start
                    if response.status == 200:
                        print(f"âœ… {name}: æˆåŠŸ ({elapsed*1000:.0f}ms)")
                        results.append((name, True))
                    else:
                        print(f"âŒ {name}: å¤±æ•— (HTTP {response.status})")
                        results.append((name, False))
            except Exception as e:
                elapsed = time.time() - start
                print(f"âŒ {name}: éŒ¯èª¤ ({type(e).__name__})")
                results.append((name, False))
    
    print("=" * 40)
    success = sum(1 for r in results if r[1])
    total = len(results)
    print(f"ðŸ“Š çµæžœ: {success}/{total} æˆåŠŸ")
    print(f"ðŸ† æˆåŠŸçŽ‡: {success/total*100:.1f}%")

asyncio.run(main())
EOF
    
    - name: 5. é‹è¡Œæ¸¬è©¦
      run: |
        cd scripts
        python quick_test.py
    
    - name: 6. å®Œæˆ
      run: |
        echo "ðŸŽ‰ æ¸¬è©¦å®Œæˆï¼"
        echo "æª¢æŸ¥ä¸Šæ–¹è¼¸å‡ºæŸ¥çœ‹å„äº¤æ˜“æ‰€é€£é€šç‹€æ…‹ã€‚"
